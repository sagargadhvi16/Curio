# docker-compose.yml
version: '3.8' # Specify a recent Docker Compose file format version

services:
  # Service for your FastAPI Backend, now leveraging Google Cloud services
  backend:
    build:
      context: ./Backend2 # Point to your Backend2 directory where Dockerfile is located
      dockerfile: Dockerfile # Specify the Dockerfile name
      args:
        # --- IMPORTANT: REPLACE WITH YOUR ACTUAL GCP PROJECT ID AND LOCATION ---
        GCP_PROJECT_ID: "your-gcp-project-id" # e.g., "my-awesome-kidwatch-project-12345"
        GCP_LOCATION: "us-central1"           # e.g., "us-central1" (Vertex AI region for Gemini)
    ports:
      - "8000:8000" # Map host port 8000 to container port 8000 (FastAPI)
    volumes:
      # Mount your Google Cloud service account key file into the container.
      # Replace './google-cloud-key.json' with the actual path to your key file on your host machine.
      # This file should be in the same directory as your docker-compose.yml.
      # It's recommended to place this key file *outside* your git repository for security.
      - ./google-cloud-key.json:/app/google-cloud-key.json:ro # :ro means read-only

      # Mount a named volume for persistent chat history.
      # This ensures chat_history.json is saved outside the container and persists across restarts.
      # The internal path /app/Backend2/chat_history.json must match CHAT_HISTORY_FILE in voice_assistant_core.py
      - backend_chat_history:/app/Backend2/chat_history.json
    networks:
      - kidwatch_network # Connects to the defined network

# Define named volumes for data persistence
volumes:
  backend_chat_history: # For your chat history file

# Define a custom network
networks:
  kidwatch_network:
    driver: bridge
